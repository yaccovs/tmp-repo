<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מקלדת חצי-חצי משופרת</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f0f0f0; overflow: hidden; }
        
        #output { font-size: 4rem; margin-bottom: 20px; height: 1.3em; border-bottom: 3px solid #333; min-width: 300px; text-align: center; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); word-break: break-all; display: flex; align-items: center; justify-content: center; }
        
        .container { display: flex; width: 95%; height: 65vh; gap: 20px; }
        
        .half-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border: none; border-radius: 30px; transition: transform 0.1s, background-color 0.3s; color: white; box-shadow: 0 6px 20px rgba(0,0,0,0.15); cursor: pointer; }
        
        .right { background-color: #4CAF50; }
        .left { background-color: #2196F3; }
        
        .half-btn.active { transform: scale(0.96); filter: brightness(1.2); }
        
        /* הגדלת האותיות בתוך הלחצן */
        .letters-display { 
            font-size: 6rem; /* גודל ענק */
            font-weight: bold;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            line-height: 1;
        }

        /* התאמה למילים ארוכות כמו "רווח" */
        .special-char { font-size: 3rem; vertical-align: middle; }
        
        .controls { margin-top: 20px; display: flex; gap: 15px; }
        
        button.tool-btn { padding: 12px 25px; font-size: 1.2rem; cursor: pointer; border-radius: 10px; border: none; background: #666; color: white; transition: background 0.2s; }
        button.tool-btn:hover { background: #444; }

        #settingsPanel {
            position: fixed; top: 10px; right: 10px; background: white; padding: 15px;
            border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 100;
            display: none; flex-direction: column; gap: 10px; border: 1px solid #ccc;
        }
        .instruction { font-size: 1.1rem; color: #444; margin-top: 15px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

    <div id="settingsPanel">
        <strong>הגדרות</strong>
        <label>זמן לחיצה כפולה (מ"ש):</label>
        <input type="number" id="delayInput" value="400" step="50" style="width: 60px;">
        <button class="tool-btn" onclick="toggleSettings()">סגור</button>
    </div>

    <div id="output"></div>

    <div class="container">
        <button id="btnRight" class="half-btn right" onclick="chooseHalf(0)">
            <div id="displayRight" class="letters-display"></div>
        </button>
        <button id="btnLeft" class="half-btn left" onclick="chooseHalf(1)">
            <div id="displayLeft" class="letters-display"></div>
        </button>
    </div>

    <div class="controls">
        <button class="tool-btn" onclick="resetSearch()">התחל אות חדשה (Esc)</button>
        <button class="tool-btn" onclick="toggleSettings()">⚙️ הגדרות</button>
    </div>

    <div class="instruction">
        הקשה אחת ⬅️ צד ירוק | שתי הקשות מהירות ⬅️ צד כחול
    </div>

    <script>
        // רשימת התווים כולל רווח ומחיקה
        const charLabels = { "SPACE": "רווח", "BACK": "⌫" };
        const allLetters = ["א", "ב", "ג", "ד", "ה", "ו", "ז", "ח", "ט", "י", "כ", "ל", "מ", "נ", "ס", "ע", "פ", "צ", "ק", "ר", "ש", "ת", "SPACE", "BACK"];
        
        let currentRange = [...allLetters];
        let clickTimer = null;

        function updateDisplay() {
            const mid = Math.ceil(currentRange.length / 2);
            const rightHalf = currentRange.slice(0, mid);
            const leftHalf = currentRange.slice(mid);

            renderHalf('displayRight', rightHalf);
            renderHalf('displayLeft', leftHalf);

            if (currentRange.length === 1) {
                handleSelection(currentRange[0]);
                // אפקט ויזואלי
                document.body.style.backgroundColor = "#fff";
                setTimeout(() => { document.body.style.backgroundColor = "#f0f0f0"; }, 200);
                setTimeout(resetSearch, 400);
            }
        }

        function renderHalf(elementId, chars) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            chars.forEach(char => {
                const span = document.createElement('span');
                if (charLabels[char]) {
                    span.innerText = charLabels[char];
                    span.className = 'special-char';
                } else {
                    span.innerText = char;
                }
                container.appendChild(span);
            });
        }

        function handleSelection(char) {
            const output = document.getElementById('output');
            let text = output.innerText;

            if (char === "BACK") {
                output.innerText = text.slice(0, -1);
            } else if (char === "SPACE") {
                // בדיקת אותיות סופיות
                const sofiotMap = { 'כ': 'ך', 'מ': 'ם', 'נ': 'ן', 'פ': 'ף', 'צ': 'ץ' };
                const lastChar = text.slice(-1);
                
                if (sofiotMap[lastChar]) {
                    output.innerText = text.slice(0, -1) + sofiotMap[lastChar] + " ";
                } else {
                    output.innerText += " ";
                }
            } else {
                output.innerText += char;
            }
        }

        function chooseHalf(index) {
            if (currentRange.length <= 1) return;
            const mid = Math.ceil(currentRange.length / 2);
            if (index === 0) {
                currentRange = currentRange.slice(0, mid);
                animateBtn('btnRight');
            } else {
                currentRange = currentRange.slice(mid);
                animateBtn('btnLeft');
            }
            updateDisplay();
        }

        function animateBtn(id) {
            const btn = document.getElementById(id);
            btn.classList.add('active');
            setTimeout(() => btn.classList.remove('active'), 150);
        }

        function resetSearch() {
            currentRange = [...allLetters];
            updateDisplay();
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
        }

        window.addEventListener('keydown', function(e) {
            if (e.repeat) return;
            if (e.key === "Escape") { resetSearch(); return; }
            if (e.target.tagName === "INPUT") return;

            const doubleClickDelay = parseInt(document.getElementById('delayInput').value) || 400;

            if (clickTimer) {
                clearTimeout(clickTimer);
                clickTimer = null;
                chooseHalf(1); // לחיצה כפולה -> חצי כחול (שמאל)
            } else {
                clickTimer = setTimeout(() => {
                    chooseHalf(0); // לחיצה בודדת -> חצי ירוק (ימין)
                    clickTimer = null;
                }, doubleClickDelay);
            }
        });

        updateDisplay();
    </script>
</body>
</html>
